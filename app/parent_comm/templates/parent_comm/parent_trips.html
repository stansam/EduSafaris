{% extends "parent_comm/base.html" %}

{% block title %}My Trips - Parent Portal{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>My Children's Trips</h2>
                <div class="badge badge-info">
                    Total Active Trips: {{ trips_data|length }}
                </div>
            </div>

            {% if trips_data %}
                <div class="row">
                    {% for data in trips_data %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card trip-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">{{ data.trip.title }}</h6>
                                <span class="badge badge-{% if data.trip.status == 'active' %}success{% else %}secondary{% endif %}">
                                    {{ data.trip.status|title }}
                                </span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-sm-6">
                                        <strong>Student:</strong><br>
                                        {{ data.participant.full_name }}
                                    </div>
                                    <div class="col-sm-6">
                                        <strong>Destination:</strong><br>
                                        {{ data.trip.destination }}
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-sm-6">
                                        <strong>Dates:</strong><br>
                                        {{ data.trip.start_date.strftime('%m/%d/%Y') }} - 
                                        {{ data.trip.end_date.strftime('%m/%d/%Y') }}
                                    </div>
                                    <div class="col-sm-6">
                                        <strong>Duration:</strong><br>
                                        {{ data.trip.duration_days }} days
                                    </div>
                                </div>

                                <!-- Status Indicators -->
                                <div class="status-grid">
                                    <div class="status-item">
                                        <div class="status-label">Consent</div>
                                        <div class="status-value">
                                            {% if data.consent_status == 'signed' %}
                                                <span class="badge badge-success">Signed</span>
                                            {% else %}
                                                <span class="badge badge-warning">Pending</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="status-item">
                                        <div class="status-label">Payment</div>
                                        <div class="status-value">
                                            <span class="badge badge-{% if data.payment_status == 'paid' %}success{% elif data.payment_status == 'partial' %}warning{% else %}danger{% endif %}">
                                                {{ data.payment_status|title }}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                {% if data.outstanding_balance > 0 %}
                                <div class="alert alert-info mt-2">
                                    <small>Outstanding Balance: ${{ "%.2f"|format(data.outstanding_balance) }}</small>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="card-footer">
                                <div class="btn-group w-100" role="group">
                                    {% if data.consent_status != 'signed' %}
                                    <a href="{{ url_for('parent_comm.consent_form', trip_id=data.trip.id) }}" 
                                       class="btn btn-primary btn-sm">
                                        Sign Consent
                                    </a>
                                    {% else %}
                                    <a href="{{ url_for('parent_comm.consent_pdf', participant_id=data.participant.id) }}" 
                                       class="btn btn-outline-secondary btn-sm" target="_blank">
                                        View Consent
                                    </a>
                                    {% endif %}
                                    
                                    <a href="{{ url_for('parent_comm.notifications') }}?trip_id={{ data.trip.id }}" 
                                       class="btn btn-outline-info btn-sm">
                                        Notifications
                                        {% if data.unread_notifications > 0 %}
                                        <span class="badge badge-danger">{{ data.unread_notifications }}</span>
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info text-center">
                    <h4>No Trips Found</h4>
                    <p>You don't have any children registered for trips yet.</p>
                    <p>Contact your child's teacher for information about upcoming educational trips.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}