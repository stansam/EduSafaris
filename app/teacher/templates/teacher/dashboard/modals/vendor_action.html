<!-- ============================================
     REQUEST QUOTE MODAL
     ============================================ -->
<div id="requestQuoteModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-file-invoice"></i> Request Quote
            </h2>
            <button class="vam-btn-close" onclick="closeRequestQuoteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="requestQuoteForm" class="vam-modal-body">
            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-suitcase"></i> Select Trip
                </label>
                <select id="rqTripSelect" class="vam-input" required>
                    <option value="">Choose a trip...</option>
                </select>
                <small class="vam-help-text">Select the trip for which you need this service</small>
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-tag"></i> Service Type
                </label>
                <select id="rqServiceType" class="vam-input" required>
                    <option value="">Select service type...</option>
                    <option value="transportation">Transportation</option>
                    <option value="accommodation">Accommodation</option>
                    <option value="activity">Activity/Tour</option>
                </select>
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-align-left"></i> Service Description
                </label>
                <textarea 
                    id="rqServiceDescription" 
                    class="vam-textarea" 
                    rows="4" 
                    placeholder="Describe the service you need in detail..."
                    required
                ></textarea>
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-list-ul"></i> Special Requirements
                </label>
                <textarea 
                    id="rqSpecialRequirements" 
                    class="vam-textarea" 
                    rows="3" 
                    placeholder="Any special requirements or preferences (optional)..."
                ></textarea>
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-comment"></i> Additional Notes
                </label>
                <textarea 
                    id="rqNotes" 
                    class="vam-textarea" 
                    rows="2" 
                    placeholder="Any additional information..."
                ></textarea>
            </div>

            <div class="vam-alert vam-alert-info">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Note:</strong> The vendor will review your request and provide a quote. You'll be notified once they respond.
                </div>
            </div>
        </form>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closeRequestQuoteModal()">
                Cancel
            </button>
            <button type="submit" form="requestQuoteForm" class="vam-btn vam-btn-primary">
                <i class="fas fa-paper-plane"></i> Send Request
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     CREATE BOOKING MODAL
     ============================================ -->
<div id="createBookingModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-plus-circle"></i> Create Booking
            </h2>
            <button class="vam-btn-close" onclick="closeCreateBookingModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="createBookingForm" class="vam-modal-body">
            <div class="vam-vendor-info" id="cbVendorInfo">
                <div class="vam-vendor-avatar">
                    <i class="fas fa-store"></i>
                </div>
                <div>
                    <h4 id="cbVendorName"></h4>
                    <span id="cbVendorType"></span>
                </div>
            </div>

            <div class="vam-form-row">
                <div class="vam-form-group">
                    <label class="vam-label required">
                        <i class="fas fa-suitcase"></i> Trip
                    </label>
                    <select id="cbTripSelect" class="vam-input" required>
                        <option value="">Select trip...</option>
                    </select>
                </div>

                <div class="vam-form-group">
                    <label class="vam-label required">
                        <i class="fas fa-tag"></i> Service Type
                    </label>
                    <select id="cbServiceType" class="vam-input" required>
                        <option value="">Select type...</option>
                        <option value="transportation">Transportation</option>
                        <option value="accommodation">Accommodation</option>
                        <option value="activity">Activity/Tour</option>
                    </select>
                </div>
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-align-left"></i> Service Description
                </label>
                <textarea 
                    id="cbServiceDescription" 
                    class="vam-textarea" 
                    rows="3" 
                    placeholder="Describe the service..."
                    required
                ></textarea>
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-dollar-sign"></i> Quoted Amount (KES)
                </label>
                <input 
                    type="number" 
                    id="cbQuotedAmount" 
                    class="vam-input" 
                    placeholder="Enter amount" 
                    min="1" 
                    step="0.01"
                    required
                >
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-list-ul"></i> Special Requirements
                </label>
                <textarea 
                    id="cbSpecialRequirements" 
                    class="vam-textarea" 
                    rows="2" 
                    placeholder="Any special requirements..."
                ></textarea>
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-comment"></i> Notes
                </label>
                <textarea 
                    id="cbNotes" 
                    class="vam-textarea" 
                    rows="2" 
                    placeholder="Additional notes..."
                ></textarea>
            </div>
        </form>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closeCreateBookingModal()">
                Cancel
            </button>
            <button type="submit" form="createBookingForm" class="vam-btn vam-btn-success">
                <i class="fas fa-check"></i> Create Booking
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     CONFIRM BOOKING MODAL
     ============================================ -->
<div id="confirmBookingModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container vam-modal-small">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-check-circle"></i> Confirm Booking
            </h2>
            <button class="vam-btn-close" onclick="closeConfirmBookingModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="confirmBookingForm" class="vam-modal-body">
            <div class="vam-booking-summary" id="cfmBookingSummary">
                <!-- Booking details will be inserted here -->
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-dollar-sign"></i> Final Amount (KES)
                </label>
                <input 
                    type="number" 
                    id="cfmFinalAmount" 
                    class="vam-input" 
                    placeholder="Enter final amount (optional)" 
                    min="1" 
                    step="0.01"
                >
                <small class="vam-help-text">Leave blank to keep the quoted amount</small>
            </div>

            <div class="vam-alert vam-alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Please confirm:</strong> By confirming this booking, you agree to the terms and the vendor will be notified.
                </div>
            </div>
        </form>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closeConfirmBookingModal()">
                Cancel
            </button>
            <button type="submit" form="confirmBookingForm" class="vam-btn vam-btn-success">
                <i class="fas fa-check"></i> Confirm Booking
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     CANCEL BOOKING MODAL
     ============================================ -->
<div id="cancelBookingModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container vam-modal-small">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-times-circle"></i> Cancel Booking
            </h2>
            <button class="vam-btn-close" onclick="closeCancelBookingModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="cancelBookingForm" class="vam-modal-body">
            <div class="vam-booking-summary" id="cnlBookingSummary">
                <!-- Booking details will be inserted here -->
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-comment-alt"></i> Cancellation Reason
                </label>
                <textarea 
                    id="cnlReason" 
                    class="vam-textarea" 
                    rows="4" 
                    placeholder="Please provide a reason for cancellation..."
                    required
                ></textarea>
            </div>

            <div class="vam-alert vam-alert-danger">
                <i class="fas fa-exclamation-circle"></i>
                <div>
                    <strong>Warning:</strong> Cancelling this booking may have consequences. The vendor will be notified immediately.
                </div>
            </div>
        </form>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closeCancelBookingModal()">
                Keep Booking
            </button>
            <button type="submit" form="cancelBookingForm" class="vam-btn vam-btn-danger">
                <i class="fas fa-times"></i> Cancel Booking
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     RATE VENDOR MODAL
     ============================================ -->
<div id="rateVendorModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-star"></i> Rate Vendor
            </h2>
            <button class="vam-btn-close" onclick="closeRateVendorModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="rateVendorForm" class="vam-modal-body">
            <div class="vam-vendor-info" id="rvVendorInfo">
                <!-- Vendor info will be inserted here -->
            </div>

            <div class="vam-form-group">
                <label class="vam-label required">
                    <i class="fas fa-star"></i> Overall Rating
                </label>
                <div class="vam-star-rating" id="rvStarRating">
                    <i class="far fa-star" data-rating="1"></i>
                    <i class="far fa-star" data-rating="2"></i>
                    <i class="far fa-star" data-rating="3"></i>
                    <i class="far fa-star" data-rating="4"></i>
                    <i class="far fa-star" data-rating="5"></i>
                </div>
                <input type="hidden" id="rvRating" required>
                <small class="vam-help-text">Click to rate</small>
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-heading"></i> Review Title
                </label>
                <input 
                    type="text" 
                    id="rvTitle" 
                    class="vam-input" 
                    placeholder="Summarize your experience..."
                    maxlength="100"
                >
            </div>

            <div class="vam-form-group">
                <label class="vam-label">
                    <i class="fas fa-comment"></i> Your Review
                </label>
                <textarea 
                    id="rvReview" 
                    class="vam-textarea" 
                    rows="5" 
                    placeholder="Share your experience with this vendor..."
                ></textarea>
            </div>

            <div class="vam-detailed-ratings">
                <h4>Detailed Ratings (Optional)</h4>
                <div class="vam-form-row">
                    <div class="vam-form-group">
                        <label class="vam-label">
                            <i class="fas fa-dollar-sign"></i> Value for Money
                        </label>
                        <select id="rvValueRating" class="vam-input">
                            <option value="">Select...</option>
                            <option value="5">5 - Excellent</option>
                            <option value="4">4 - Good</option>
                            <option value="3">3 - Average</option>
                            <option value="2">2 - Poor</option>
                            <option value="1">1 - Very Poor</option>
                        </select>
                    </div>

                    <div class="vam-form-group">
                        <label class="vam-label">
                            <i class="fas fa-shield-alt"></i> Safety
                        </label>
                        <select id="rvSafetyRating" class="vam-input">
                            <option value="">Select...</option>
                            <option value="5">5 - Excellent</option>
                            <option value="4">4 - Good</option>
                            <option value="3">3 - Average</option>
                            <option value="2">2 - Poor</option>
                            <option value="1">1 - Very Poor</option>
                        </select>
                    </div>
                </div>

                <div class="vam-form-row">
                    <div class="vam-form-group">
                        <label class="vam-label">
                            <i class="fas fa-tasks"></i> Organization
                        </label>
                        <select id="rvOrganizationRating" class="vam-input">
                            <option value="">Select...</option>
                            <option value="5">5 - Excellent</option>
                            <option value="4">4 - Good</option>
                            <option value="3">3 - Average</option>
                            <option value="2">2 - Poor</option>
                            <option value="1">1 - Very Poor</option>
                        </select>
                    </div>

                    <div class="vam-form-group">
                        <label class="vam-label">
                            <i class="fas fa-comments"></i> Communication
                        </label>
                        <select id="rvCommunicationRating" class="vam-input">
                            <option value="">Select...</option>
                            <option value="5">5 - Excellent</option>
                            <option value="4">4 - Good</option>
                            <option value="3">3 - Average</option>
                            <option value="2">2 - Poor</option>
                            <option value="1">1 - Very Poor</option>
                        </select>
                    </div>
                </div>
            </div>
        </form>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closeRateVendorModal()">
                Cancel
            </button>
            <button type="submit" form="rateVendorForm" class="vam-btn vam-btn-primary">
                <i class="fas fa-paper-plane"></i> Submit Rating
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     PAYMENT MODAL (M-PESA)
     ============================================ -->
<div id="paymentModal" class="vam-modal-overlay" style="display: none;">
    <div class="vam-modal-container">
        <div class="vam-modal-header">
            <h2 class="vam-modal-title">
                <i class="fas fa-credit-card"></i> Make Payment
            </h2>
            <button class="vam-btn-close" onclick="closePaymentModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="vam-modal-body">
            <div class="vam-payment-summary" id="pmtBookingSummary">
                <!-- Booking summary will be inserted here -->
            </div>

            <div class="vam-payment-tabs">
                <button class="vam-payment-tab active" data-method="mpesa">
                    <i class="fas fa-mobile-alt"></i> M-PESA
                </button>
                <button class="vam-payment-tab" data-method="card" disabled>
                    <i class="fas fa-credit-card"></i> Card (Coming Soon)
                </button>
            </div>

            <form id="mpesaPaymentForm" class="vam-payment-form">
                <div class="vam-form-group">
                    <label class="vam-label required">
                        <i class="fas fa-phone"></i> M-PESA Phone Number
                    </label>
                    <input 
                        type="tel" 
                        id="pmtPhoneNumber" 
                        class="vam-input" 
                        placeholder="254XXXXXXXXX" 
                        pattern="^254[0-9]{9}$"
                        maxlength="12"
                        required
                    >
                    <small class="vam-help-text">Format: 254XXXXXXXXX (e.g., 254712345678)</small>
                </div>

                <div class="vam-form-group">
                    <label class="vam-label required">
                        <i class="fas fa-dollar-sign"></i> Amount (KES)
                    </label>
                    <input 
                        type="number" 
                        id="pmtAmount" 
                        class="vam-input" 
                        placeholder="Enter amount" 
                        min="1" 
                        step="0.01"
                        required
                        readonly
                    >
                </div>

                <div class="vam-alert vam-alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>How it works:</strong>
                        <ol style="margin: 10px 0 0 0; padding-left: 20px;">
                            <li>Enter your M-PESA registered phone number</li>
                            <li>Click "Initiate Payment"</li>
                            <li>You'll receive an STK push on your phone</li>
                            <li>Enter your M-PESA PIN to complete</li>
                        </ol>
                    </div>
                </div>
            </form>

            <!-- Payment Processing State -->
            <div id="pmtProcessingState" class="vam-payment-processing" style="display: none;">
                <div class="vam-spinner"></div>
                <h3>Processing Payment...</h3>
                <p>Please check your phone and enter your M-PESA PIN</p>
                <button type="button" class="vam-btn vam-btn-secondary" onclick="checkPaymentStatus()">
                    <i class="fas fa-sync-alt"></i> Check Status
                </button>
            </div>
        </div>

        <div class="vam-modal-footer">
            <button type="button" class="vam-btn vam-btn-secondary" onclick="closePaymentModal()">
                Cancel
            </button>
            <button type="submit" form="mpesaPaymentForm" class="vam-btn vam-btn-success" id="btnInitiatePayment">
                <i class="fas fa-mobile-alt"></i> Initiate Payment
            </button>
        </div>
    </div>
</div>